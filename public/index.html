<!DOCTYPE html>
<html lang="en">
<head>
<title>Angular Issues</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="build/build.css">
<link rel="stylesheet" href="css/site.css">
<script src="build/build.js"></script>
<script src="js/markdown.js"></script>
<script type="text/javascript">
var startDate = new Date(Date.now()-1000*60*60*24*7);
var scriptUrl = 'https://api.github.com/repos/angular/angular/issues?since=' + startDate.toISOString() + '&callback=render';
function render(response) {
	var meta = response.meta;
	var data = response.data;
	console.log(meta);
	console.log(data);
	var header_template = $('#header_template').html();
	var issue_template = $('#issue_template').html();
	Mustache.parse(header_template);
	Mustache.parse(issue_template);
	$('#header_target').html(Mustache.render(header_template, { 'date' : startDate.toISOString() }));
	var odd = false;
	var rendered = Mustache.render(issue_template, {
		'data' : data,
		'bodyf' : function() { return markdown.toHTML(this.body).replace('\n', '<br>'); },
		'userf' : function() { return this.user && this.user.login || '&nbsp;'; },
		'assigneef' : function() { return this.assignee && this.assignee.login || '<i>Not assigned</i>'; },
		'row' : function() { odd = !odd; return odd ? "row-odd" : "row-even"; }
	});
	$('#issue_target').html(rendered);
}

// With the results from the API, display, in HTML, the returned
// values with their title, body, user login, and assignee login.
console.log('scriptURL: ' + scriptUrl);

var script = document.createElement('script');
// script.src = 'https://api.github.com?callback=foo';
// script.src = 'https://api.github.com/repos/angular/angular/issues?since=2016103T000000Z&callback=render';
script.src = 'js/issues.js';

document.getElementsByTagName('head')[0].appendChild(script);
		
</script>
</head>

<body>
<div class="container-fluid">
<div id="header_target"><h2>Angular Issues</h2></div>
<script id="header_template" type="x-tmpl-mustache">
  <h2>Angular Issues since {{date}}</h2>
</script>
<div class="container-fluid" id="issue_target">Loading...</div>
<script id="issue_template" type="x-tmpl-mustache">
{{#data}}
	<div class="row {{row}}">
	  <div class="col-sm-12"><div class="row"><div class="col-sm-1 custom-text-right"><strong>Title:</strong></div><div class="col-sm-11">{{title}}</div></div></div>
	  <div class="col-sm-12"><div class="row"><div class="col-sm-1 custom-text-right"><strong>User:</strong></div><div class="col-sm-11">{{{userf}}}</div></div></div>
	  <div class="col-sm-12"><div class="row"><div class="col-sm-1 custom-text-right"><strong>Assignee:</strong></div><div class="col-sm-11">{{{assigneef}}}</div></div></div>
	  <div class="col-sm-12"><div class="row"><div class="col-sm-1 custom-text-right"><strong>Issue:</strong></div><div class="col-sm-11">{{{bodyf}}}</div></div></div>
	</div>
{{/data}}
</script>
</div>
</body>
</html>
